<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Family Hub</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #f5f7fb;
      --accent: #4f46e5;
      --accent-soft: #eef2ff;
      --accent-strong: #4338ca;
      --card-bg: #ffffff;
      --text-main: #111827;
      --text-muted: #6b7280;
      --border-soft: #e5e7eb;
      --danger: #ef4444;
      --done-text: #9ca3af;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #e0f2fe, #f5f7fb 55%);
      color: var(--text-main);
      display: flex;
      align-items: stretch;
      justify-content: center;
      padding: 1.5rem 1rem 2.5rem;
    }

    .app {
      width: 100%;
      max-width: 1000px;
      margin: auto;
    }

    header {
      text-align: center;
      margin-bottom: 0.75rem;
    }

    header h1 {
      font-size: 1.7rem;
      margin: 0;
      letter-spacing: 0.03em;
    }

    header h1 span {
      color: var(--accent);
    }

    header p {
      margin: 0.25rem 0 0;
      font-size: 0.9rem;
      color: var(--text-muted);
    }

    .layout {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    @media (min-width: 768px) {
      .layout {
        flex-direction: row;
        align-items: flex-start;
      }
    }

    .card {
      background: var(--card-bg);
      border-radius: 1rem;
      box-shadow:
        0 18px 45px rgba(15, 23, 42, 0.06),
        0 0 0 1px rgba(148, 163, 184, 0.18);
      padding: 1.25rem 1rem 1.1rem;
    }

    .calendar-card { flex: 1.7; }
    .tasks-card { flex: 1; max-width: 360px; }

    .calendar-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 0.6rem;
    }

    .calendar-month {
      font-weight: 600;
    }

    .calendar-nav button {
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      background: #f9fafb;
      padding: 0.3rem 0.6rem;
      font-size: 0.85rem;
    }

    .view-toggle {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 0.6rem;
    }

    .view-btn {
      padding: 0.3rem 0.8rem;
      border-radius: 999px;
      background: #f3f4f6;
      border: 1px solid var(--border-soft);
      font-size: 0.75rem;
    }

    .view-btn.active {
      background: var(--accent);
      color: white;
      border-color: var(--accent);
    }

    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 0.25rem;
    }

    .day-name {
      text-align: center;
      color: var(--text-muted);
      font-size: 0.8rem;
    }

    .day-cell {
      border-radius: 0.6rem;
      background: #f9fafb;
      padding: 0.3rem;
      min-height: 3.6rem;
      border: 1px solid transparent;
    }

    .day-cell.other-month {
      opacity: 0.3;
    }

    .day-cell.today {
      border-color: #93c5fd;
    }

    .owner-badge {
      width: 0.55rem;
      height: 0.55rem;
      border-radius: 999px;
      background: transparent;
    }

    .day-tasks-inline {
      margin-top: 0.2rem;
      font-size: 0.72rem;
      display: flex;
      flex-direction: column;
      gap: 0.15rem;
      max-height: 2.4rem;
      overflow: hidden;
    }

    .day-task-inline {
      display: flex;
      gap: 0.3rem;
      align-items: center;
    }

    .day-task-text.done {
      text-decoration: line-through;
      color: var(--done-text);
    }

    /* Tasks panel */
    #task-list { padding: 0; margin: 0; list-style: none; }
    #task-list li {
      margin-bottom: 0.5rem;
      padding: 0.6rem;
      border-radius: 0.6rem;
      background: #f9fafb;
      border: 1px solid var(--border-soft);
    }
    #add-button {
      margin-top: 0.4rem;
      padding: 0.6rem;
      border-radius: 999px;
      background: var(--accent);
      color: white;
      border: none;
      font-weight: 600;
    }
  </style>
</head>

<body>
<div class="app">
  <header>
    <h1>Family <span>Hub</span></h1>
    <p>Shared calendar + tasks synced across all devices</p>
  </header>

  <div class="layout">
    <section class="card calendar-card">

      <div class="calendar-header">
        <div id="calendar-month-label"></div>
        <div class="calendar-nav">
          <button id="prev-month">‹</button>
          <button id="next-month">›</button>
        </div>
      </div>

      <div class="view-toggle">
        <button class="view-btn active" id="view-month">Month</button>
        <button class="view-btn" id="view-week">Week</button>
      </div>

      <div class="calendar-grid" id="calendar-grid"></div>
    </section>

    <section class="card tasks-card">
      <h2>Tasks</h2>

      <form id="task-form" onsubmit="return false;">
        <input id="task-input" placeholder="Task" />
        <input id="task-owner" placeholder="Owner (Sara)" />
        <input id="task-date" type="date" />
        <select id="task-frequency">
          <option value="once">One time</option>
          <option value="daily">Daily</option>
          <option value="weekly">Weekly</option>
          <option value="monthly">Monthly</option>
        </select>

        <button id="add-button" type="button">Add</button>
      </form>

      <ul id="task-list"></ul>
    </section>
  </div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
  import {
    getFirestore, collection, addDoc, updateDoc,
    deleteDoc, doc, onSnapshot
  } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

  // --- Your Firebase config ---
  const firebaseConfig = {
    apiKey: "AIzaSyDxE4NcUZMqm4CMMJV7fD30DMCTC_BAxuY",
    authDomain: "leo2025-4c8a6.firebaseapp.com",
    projectId: "leo2025-4c8a6",
    storageBucket: "leo2025-4c8a6.firebasestorage.app",
    messagingSenderId: "17689554146",
    appId: "1:17689554146:web:30f171a704ea83ce6282bb",
    measurementId: "G-6BWXTN2ZQC"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const tasksCollection = collection(db, "tasks");

  let tasks = [];
  let viewMode = "month";
  let currentBaseDate = new Date();

  const monthLabel = document.getElementById("calendar-month-label");
  const grid = document.getElementById("calendar-grid");

  onSnapshot(tasksCollection, snap => {
    tasks = snap.docs.map(d => ({ id: d.id, ...d.data() }));
    renderCalendar();
    renderTaskList();
  });

  function occursOnDate(task, date) {
    const start = new Date(task.startDate);
    const d = new Date(date);

    if (task.frequency === "daily") return d >= start;
    if (task.frequency === "weekly") {
      const diff = Math.floor((d - start) / (1000*60*60*24));
      return diff >= 0 && diff % 7 === 0;
    }
    if (task.frequency === "monthly") return d.getDate() === start.getDate();
    return d.toDateString() === start.toDateString();
  }

  function renderCalendar() {
    grid.innerHTML = "";
    const days = ["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];
    days.forEach(d => {
      const el = document.createElement("div");
      el.className = "day-name";
      el.textContent = d;
      grid.appendChild(el);
    });

    if (viewMode === "month") {
      renderMonthView();
    } else {
      renderWeekView();
    }
  }

  function renderMonthView() {
    const year = currentBaseDate.getFullYear();
    const month = currentBaseDate.getMonth();
    monthLabel.textContent = currentBaseDate.toLocaleDateString(undefined, {
      month: "long",
      year: "numeric"
    });

    const first = new Date(year, month, 1);
    const startDay = first.getDay();
    const daysInMonth = new Date(year, month+1, 0).getDate();

    const cells = [];
    // previous month padding
    for (let i = 0; i < startDay; i++) {
      const d = new Date(year, month, i - startDay + 1);
      cells.push({ date: d, other: true });
    }

    // this month
    for (let day = 1; day <= daysInMonth; day++) {
      cells.push({ date: new Date(year, month, day), other: false });
    }

    cells.forEach(c => addDayCell(c.date, c.other));
  }

  function renderWeekView() {
    const base = new Date(currentBaseDate);
    const start = new Date(base);
    start.setDate(base.getDate() - base.getDay());
    const end = new Date(start);
    end.setDate(start.getDate() + 6);

    monthLabel.textContent =
      `Week of ${start.toLocaleDateString()} – ${end.toLocaleDateString()}`;

    for (let i = 0; i < 7; i++) {
      const d = new Date(start);
      d.setDate(start.getDate() + i);
      addDayCell(d, false);
    }
  }

  function addDayCell(date, otherMonth) {
    const cell = document.createElement("div");
    cell.className = "day-cell";
    if (otherMonth) cell.classList.add("other-month");

    const today = new Date().toDateString();
    if (date.toDateString() === today) {
      cell.classList.add("today");
    }

    const header = document.createElement("div");
    header.style.display = "flex";
    header.style.justifyContent = "space-between";
    header.innerHTML = `
      <span>${date.getDate()}</span>
      <span class="owner-badge"></span>
    `;
    cell.appendChild(header);

    const matches = tasks.filter(t => occursOnDate(t, date));
    if (matches.length) {
      const ownerColor = getOwnerColor(matches[0].owner);
      header.querySelector(".owner-badge").style.background = ownerColor;

      const wrap = document.createElement("div");
      wrap.className = "day-tasks-inline";

      matches.slice(0,3).forEach(t => {
        const row = document.createElement("div");
        row.className = "day-task-inline";
        const dot = document.createElement("div");
        dot.style.width = "0.45rem";
        dot.style.height = "0.45rem";
        dot.style.borderRadius = "999px";
        dot.style.background = getOwnerColor(t.owner);
        row.appendChild(dot);

        const label = document.createElement("span");
        label.className = "day-task-text";
        if (t.status === "Done") label.classList.add("done");
        label.textContent = t.text;
        row.appendChild(label);

        wrap.appendChild(row);
      });

      cell.appendChild(wrap);
    }

    grid.appendChild(cell);
  }

  const ownerColors = ["#f97316","#22c55e","#3b82f6","#ec4899","#a855f7","#eab308"];
  const ownerMap = {};
  function getOwnerColor(owner) {
    const key = owner.toLowerCase();
    if (!ownerMap[key]) {
      ownerMap[key] = ownerColors[Object.keys(ownerMap).length % ownerColors.length];
    }
    return ownerMap[key];
  }

  function renderTaskList() {
    const list = document.getElementById("task-list");
    list.innerHTML = "";
    tasks.forEach(t => {
      const li = document.createElement("li");

      const title = document.createElement("div");
      title.textContent = t.text;
      if (t.status === "Done") {
        title.style.textDecoration = "line-through";
        title.style.color = "#9ca3af";
      }
      li.appendChild(title);

      const meta = document.createElement("div");
      meta.style.fontSize = "0.75rem";
      meta.style.color = "#6b7280";
      meta.textContent = `${t.owner} • ${t.startDate} • ${t.frequency}`;
      li.appendChild(meta);

      const status = document.createElement("select");
      ["Not started","In progress","Done"].forEach(s => {
        const opt = document.createElement("option");
        opt.textContent = s;
        if (t.status === s) opt.selected = true;
        status.appendChild(opt);
      });

      status.onchange = () =>
        updateDoc(doc(db, "tasks", t.id), { status: status.value });

      li.appendChild(status);

      list.appendChild(li);
    });
  }

  document.getElementById("add-button").onclick = async () => {
    const text = document.getElementById("task-input").value.trim();
    const owner = document.getElementById("task-owner").value.trim();
    const date = document.getElementById("task-date").value;
    const freq = document.getElementById("task-frequency").value;

    if (!text || !date) {
      alert("Please fill the task and date");
      return;
    }

    await addDoc(tasksCollection, {
      text,
      owner: owner || "Family",
      startDate: date,
      frequency: freq,
      status: "Not started"
    });

    document.getElementById("task-input").value = "";
    document.getElementById("task-owner").value = "";
  };

  document.getElementById("view-month").onclick = () => {
    viewMode = "month";
    document.getElementById("view-month").classList.add("active");
    document.getElementById("view-week").classList.remove("active");
    renderCalendar();
  };

  document.getElementById("view-week").onclick = () => {
    viewMode = "week";
    document.getElementById("view-week").classList.add("active");
    document.getElementById("view-month").classList.remove("active");
    renderCalendar();
  };

  document.getElementById("prev-month").onclick = () => {
    if (viewMode === "month") {
      currentBaseDate.setMonth(currentBaseDate.getMonth() - 1);
    } else {
      currentBaseDate.setDate(currentBaseDate.getDate() - 7);
    }
    renderCalendar();
  };

  document.getElementById("next-month").onclick = () => {
    if (viewMode === "month") {
      currentBaseDate.setMonth(currentBaseDate.getMonth() + 1);
    } else {
      currentBaseDate.setDate(currentBaseDate.getDate() + 7);
    }
    renderCalendar();
  };

  renderCalendar();
</script>

</body>
</html>
