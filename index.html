<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Family Hub</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #f5f7fb;
      --accent: #4f46e5;
      --accent-soft: #eef2ff;
      --accent-strong: #4338ca;
      --card-bg: #ffffff;
      --text-main: #111827;
      --text-muted: #6b7280;
      --border-soft: #e5e7eb;
      --danger: #ef4444;
      --done-text: #9ca3af;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #e0f2fe, #f5f7fb 55%);
      color: var(--text-main);
      display: flex;
      align-items: stretch;
      justify-content: center;
      padding: 1.5rem 1rem 2.5rem;
    }

    .app {
      width: 100%;
      max-width: 1000px;
      margin: auto;
    }

    header {
      text-align: center;
      margin-bottom: 1.25rem;
    }

    header h1 {
      font-size: 1.7rem;
      margin: 0;
      letter-spacing: 0.03em;
    }

    header h1 span {
      color: var(--accent);
    }

    header p {
      margin: 0.25rem 0 0;
      font-size: 0.9rem;
      color: var(--text-muted);
    }

    .layout {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    @media (min-width: 768px) {
      .layout {
        flex-direction: row;
        align-items: flex-start;
      }
    }

    .card {
      background: var(--card-bg);
      border-radius: 1rem;
      box-shadow:
        0 18px 45px rgba(15, 23, 42, 0.06),
        0 0 0 1px rgba(148, 163, 184, 0.18);
      padding: 1.25rem 1rem 1.1rem;
    }

    @media (min-width: 480px) {
      .card {
        padding: 1.5rem 1.5rem 1.25rem;
      }
    }

    .card h2 {
      font-size: 1.1rem;
      margin: 0 0 0.75rem;
      display: flex;
      align-items: center;
      gap: 0.4rem;
    }

    .pill {
      font-size: 0.75rem;
      padding: 0.1rem 0.45rem;
      border-radius: 999px;
      background: var(--accent-soft);
      color: var(--accent-strong);
      font-weight: 500;
      border: 1px solid rgba(129, 140, 248, 0.4);
    }

    .helper-text {
      font-size: 0.8rem;
      color: var(--text-muted);
      margin-bottom: 0.75rem;
    }

    /* Make calendar dominant */
    .calendar-card { flex: 1.7; }
    .tasks-card { flex: 1; max-width: 360px; }

    /* Form */

    #task-form {
      display: grid;
      grid-template-columns: 1fr;
      gap: 0.5rem;
      margin-bottom: 0.9rem;
    }

    @media (min-width: 600px) {
      #task-form {
        grid-template-columns: minmax(0, 1.4fr) repeat(3, minmax(0, 1fr));
        align-items: center;
      }
    }

    .field {
      display: flex;
      flex-direction: column;
      gap: 0.2rem;
    }

    .field-label {
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    input[type="text"],
    input[type="date"],
    select {
      padding: 0.5rem 0.65rem;
      font-size: 0.85rem;
      border-radius: 0.6rem;
      border: 1px solid var(--border-soft);
      background: #f9fafb;
      outline: none;
      transition: border-color 0.15s, box-shadow 0.15s, background 0.15s;
      width: 100%;
    }

    input:focus,
    select:focus {
      border-color: var(--accent);
      background: #ffffff;
      box-shadow: 0 0 0 2px rgba(129, 140, 248, 0.25);
    }

    #add-button {
      margin-top: 0.2rem;
      padding: 0.55rem 0.9rem;
      font-size: 0.9rem;
      font-weight: 600;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      background: linear-gradient(135deg, var(--accent), var(--accent-strong));
      color: #ffffff;
      box-shadow: 0 8px 16px rgba(79, 70, 229, 0.35);
      white-space: nowrap;
      width: 100%;
      transition: transform 0.08s ease-out, box-shadow 0.08s ease-out, opacity 0.1s;
    }

    @media (min-width: 600px) {
      #add-button {
        width: auto;
        justify-self: flex-end;
      }
    }

    #add-button:active {
      transform: translateY(1px) scale(0.98);
      box-shadow: 0 4px 10px rgba(79, 70, 229, 0.3);
      opacity: 0.9;
    }

    #empty-state {
      font-size: 0.9rem;
      color: var(--text-muted);
      border-radius: 0.75rem;
      border: 1px dashed rgba(148, 163, 184, 0.7);
      padding: 0.6rem 0.75rem;
      background: #f9fafb;
      display: none;
      margin-bottom: 0.4rem;
    }

    /* Task list */

    #task-list {
      list-style: none;
      padding: 0;
      margin: 0;
      max-height: 260px;
      overflow-y: auto;
      scrollbar-width: thin;
    }

    #task-list li {
      display: flex;
      flex-direction: column;
      gap: 0.35rem;
      padding: 0.55rem 0.6rem;
      border-radius: 0.65rem;
      border: 1px solid var(--border-soft);
      background: #f9fafb;
      margin-bottom: 0.45rem;
    }

    .task-top {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 0.5rem;
    }

    .task-title {
      font-size: 0.9rem;
      font-weight: 500;
      word-wrap: break-word;
      word-break: break-word;
    }

    .task-title.done {
      color: var(--done-text);
      text-decoration: line-through;
    }

    .task-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 0.35rem;
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .tag {
      padding: 0.1rem 0.45rem;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.8);
      background: #f3f4f6;
    }

    .tag.owner {
      border-color: rgba(59, 130, 246, 0.8);
      background: #dbeafe;
      color: #1d4ed8;
    }

    .tag.date {
      border-color: rgba(16, 185, 129, 0.8);
      background: #d1fae5;
      color: #047857;
    }

    .tag.frequency {
      border-color: rgba(129, 140, 248, 0.8);
      background: #e0e7ff;
      color: #4338ca;
    }

    .task-actions {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 0.5rem;
      margin-top: 0.25rem;
    }

    .status-label {
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    .delete-btn {
      border: none;
      background: none;
      cursor: pointer;
      font-size: 1rem;
      padding: 0.25rem;
      border-radius: 999px;
      transition: background 0.12s, transform 0.08s;
      color: var(--danger);
      align-self: flex-end;
    }

    .delete-btn:active {
      transform: scale(0.93);
      background: rgba(248, 113, 113, 0.12);
    }

    /* Calendar */

    .calendar-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 0.5rem;
      margin-bottom: 0.6rem;
    }

    .calendar-header-title {
      display: flex;
      flex-direction: column;
      gap: 0.15rem;
    }

    .calendar-header-title span {
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .calendar-month {
      font-weight: 600;
    }

    .calendar-nav {
      display: flex;
      gap: 0.3rem;
    }

    .calendar-nav button {
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      background: #f9fafb;
      padding: 0.25rem 0.55rem;
      font-size: 0.8rem;
      cursor: pointer;
    }

    .calendar-nav button:active {
      background: #e5e7eb;
    }

    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 0.25rem;
      font-size: 0.75rem;
    }

    .day-name {
      text-align: center;
      font-size: 0.72rem;
      color: var(--text-muted);
      padding-bottom: 0.2rem;
    }

    .day-cell {
      border-radius: 0.6rem;
      border: 1px solid transparent;
      padding: 0.25rem 0.2rem 0.35rem;
      min-height: 3.3rem;
      display: flex;
      flex-direction: column;
      cursor: pointer;
      background: #f9fafb;
      transition: background 0.12s, border-color 0.12s;
    }

    .day-cell.other-month {
      opacity: 0.35;
    }

    .day-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 0.25rem;
      margin-bottom: 0.15rem;
    }

    .day-number {
      font-size: 0.8rem;
    }

    .owner-badge {
      width: 0.6rem;
      height: 0.6rem;
      border-radius: 999px;
      flex-shrink: 0;
    }

    .day-tasks-inline {
      display: flex;
      flex-direction: column;
      gap: 0.15rem;
      max-height: 2.3rem;
      overflow: hidden;
    }

    .day-task-inline {
      display: flex;
      align-items: center;
      gap: 0.2rem;
      font-size: 0.7rem;
      white-space: nowrap;
      text-overflow: ellipsis;
      overflow: hidden;
    }

    .day-task-dot {
      width: 0.45rem;
      height: 0.45rem;
      border-radius: 999px;
      flex-shrink: 0;
    }

    .day-task-text {
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .day-task-text.done {
      color: var(--done-text);
      text-decoration: line-through;
    }

    .day-cell.selected {
      border-color: var(--accent);
      background: #e0e7ff;
    }

    .day-cell.today {
      border-color: rgba(96, 165, 250, 0.8);
    }

    footer {
      text-align: center;
      margin-top: 1rem;
      font-size: 0.78rem;
      color: var(--text-muted);
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <h1>Family <span>Hub</span></h1>
      <p>Color-coded calendar + task list for the whole family ✨</p>
    </header>

    <div class="layout">
      <!-- Calendar FIRST (main focus) -->
      <section class="card calendar-card" aria-label="Family calendar">
        <div class="calendar-header">
          <div class="calendar-header-title">
            <span>Calendar</span>
            <div class="calendar-month" id="calendar-month-label"></div>
          </div>
          <div class="calendar-nav">
            <button type="button" id="prev-month">‹</button>
            <button type="button" id="next-month">›</button>
          </div>
        </div>

        <div class="helper-text">
          Each day shows tasks inside the square. Color = owner. Gray + strikethrough = done.
        </div>

        <div class="calendar-grid" id="calendar-grid">
          <!-- JS fills this -->
        </div>
      </section>

      <!-- Tasks SECOND (smaller) -->
      <section class="card tasks-card" aria-label="Shared family tasks">
        <h2>Tasks <span class="pill">List</span></h2>
        <p class="helper-text">
          Add a task, who owns it, when it starts, and how often it repeats.
        </p>

        <form id="task-form" autocomplete="off" onsubmit="return false;">
          <div class="field">
            <span class="field-label">Task</span>
            <input
              id="task-input"
              type="text"
              placeholder="Example: Take out the garbage"
            />
          </div>

          <div class="field">
            <span class="field-label">Owner</span>
            <input
              id="task-owner"
              type="text"
              placeholder="Who? (e.g. Sara)"
            />
          </div>

          <div class="field">
            <span class="field-label">Start date</span>
            <input id="task-date" type="date" />
          </div>

          <div class="field">
            <span class="field-label">Frequency</span>
            <select id="task-frequency">
              <option value="once">One time</option>
              <option value="daily">Daily</option>
              <option value="weekly">Weekly</option>
              <option value="monthly">Monthly</option>
            </select>
          </div>

          <button type="button" id="add-button">Add</button>
        </form>

        <div id="empty-state">
          No tasks yet. Add the first one and they’ll show up here and on the calendar.
        </div>

        <ul id="task-list"></ul>
      </section>
    </div>

    <footer>
      Tasks are saved on this device. Open the same link on each phone to have a shared view.
    </footer>
  </div>

  <script>
    const STORAGE_KEY = "family_hub_tasks";

    let tasks = [];
    let currentMonth = new Date();
    currentMonth.setDate(1);
    let selectedDateStr = null;

    const taskInput = document.getElementById("task-input");
    const ownerInput = document.getElementById("task-owner");
    const dateInput = document.getElementById("task-date");
    const freqSelect = document.getElementById("task-frequency");
    const addButton = document.getElementById("add-button");
    const taskListEl = document.getElementById("task-list");
    const emptyStateEl = document.getElementById("empty-state");
    const calendarGrid = document.getElementById("calendar-grid");
    const monthLabel = document.getElementById("calendar-month-label");
    const prevMonthBtn = document.getElementById("prev-month");
    const nextMonthBtn = document.getElementById("next-month");

    function todayStr() {
      return new Date().toISOString().slice(0, 10);
    }

    if (dateInput) {
      dateInput.value = todayStr();
    }

    // Owner -> color mapping (stable for the session)
    const ownerColorMap = {};
    const ownerColors = [
      "#f97316", // orange
      "#22c55e", // green
      "#3b82f6", // blue
      "#ec4899", // pink
      "#a855f7", // purple
      "#eab308"  // yellow
    ];

    function getOwnerKey(owner) {
      const trimmed = (owner || "").trim();
      return trimmed ? trimmed.toLowerCase() : "family";
    }

    function getOwnerColor(owner) {
      const key = getOwnerKey(owner);
      if (!ownerColorMap[key]) {
        const idx = Object.keys(ownerColorMap).length % ownerColors.length;
        ownerColorMap[key] = ownerColors[idx];
      }
      return ownerColorMap[key];
    }

    function migrateTasks(raw) {
      if (!Array.isArray(raw)) return [];
      if (raw.length === 0) return [];
      if (typeof raw[0] === "string") {
        return raw.map((text, index) => ({
          id: Date.now() + index,
          text,
          owner: "Family",
          startDate: todayStr(),
          frequency: "once",
          status: "Not started",
        }));
      }
      return raw;
    }

    function loadTasks() {
      const saved = localStorage.getItem(STORAGE_KEY);
      if (!saved) {
        tasks = [];
      } else {
        try {
          const parsed = JSON.parse(saved);
          tasks = migrateTasks(parsed);
        } catch (e) {
          console.error("Could not parse tasks", e);
          tasks = [];
        }
      }
      saveTasks(); // normalize format
      updateEmptyState();
      renderTaskList();
      renderCalendar();
    }

    function saveTasks() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(tasks));
      updateEmptyState();
      renderCalendar();
    }

    function updateEmptyState() {
      emptyStateEl.style.display = tasks.length ? "none" : "block";
    }

    function renderTaskList() {
      taskListEl.innerHTML = "";
      tasks.forEach((task) => {
        const li = document.createElement("li");

        const top = document.createElement("div");
        top.className = "task-top";

        const title = document.createElement("div");
        title.className = "task-title";
        title.textContent = task.text || "(no description)";
        if (task.status === "Done") {
          title.classList.add("done");
        }
        top.appendChild(title);

        const delBtn = document.createElement("button");
        delBtn.className = "delete-btn";
        delBtn.type = "button";
        delBtn.textContent = "✕";
        delBtn.addEventListener("click", () => {
          tasks = tasks.filter((t) => t.id !== task.id);
          saveTasks();
          renderTaskList();
        });
        top.appendChild(delBtn);

        const meta = document.createElement("div");
        meta.className = "task-meta";

        const ownerTag = document.createElement("span");
        ownerTag.className = "tag owner";
        ownerTag.textContent = task.owner || "Family";
        ownerTag.style.borderColor = getOwnerColor(task.owner);
        ownerTag.style.backgroundColor = getOwnerColor(task.owner) + "20";
        meta.appendChild(ownerTag);

        const dateTag = document.createElement("span");
        dateTag.className = "tag date";
        dateTag.textContent = task.startDate || todayStr();
        meta.appendChild(dateTag);

        const freqTag = document.createElement("span");
        freqTag.className = "tag frequency";
        const freqText =
          task.frequency === "daily"
            ? "Daily"
            : task.frequency === "weekly"
            ? "Weekly"
            : task.frequency === "monthly"
            ? "Monthly"
            : "One time";
        freqTag.textContent = freqText;
        meta.appendChild(freqTag);

        const actions = document.createElement("div");
        actions.className = "task-actions";

        const statusLabel = document.createElement("span");
        statusLabel.className = "status-label";
        statusLabel.textContent = "Status: ";

        const statusSelect = document.createElement("select");
        ["Not started", "In progress", "Done"].forEach((s) => {
          const opt = document.createElement("option");
          opt.value = s;
          opt.textContent = s;
          if (task.status === s) opt.selected = true;
          statusSelect.appendChild(opt);
        });
        statusSelect.addEventListener("change", () => {
          task.status = statusSelect.value;
          saveTasks();
          renderTaskList(); // so gray/strikethrough updates
        });

        actions.appendChild(statusLabel);
        actions.appendChild(statusSelect);

        li.appendChild(top);
        li.appendChild(meta);
        li.appendChild(actions);

        taskListEl.appendChild(li);
      });
    }

    function isSameDay(d1, d2) {
      return (
        d1.getFullYear() === d2.getFullYear() &&
        d1.getMonth() === d2.getMonth() &&
        d1.getDate() === d2.getDate()
      );
    }

    function occursOnDate(task, date) {
      if (!task.startDate) return false;
      const start = new Date(task.startDate + "T00:00:00");
      const target = new Date(date.getFullYear(), date.getMonth(), date.getDate());
      if (target < start) return false;

      switch (task.frequency) {
        case "daily":
          return true;
        case "weekly": {
          const diffMs = target - start;
          const diffDays = Math.round(diffMs / (1000 * 60 * 60 * 24));
          return diffDays % 7 === 0;
        }
        case "monthly":
          return target.getDate() === start.getDate();
        default: // once
          return isSameDay(target, start);
      }
    }

    function formatMonthLabel(date) {
      return date.toLocaleDateString(undefined, { month: "long", year: "numeric" });
    }

    function renderCalendar() {
      calendarGrid.innerHTML = "";

      const year = currentMonth.getFullYear();
      const month = currentMonth.getMonth();
      monthLabel.textContent = formatMonthLabel(currentMonth);

      const dayNames = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
      dayNames.forEach((name) => {
        const div = document.createElement("div");
        div.className = "day-name";
        div.textContent = name;
        calendarGrid.appendChild(div);
      });

      const firstDayOfMonth = new Date(year, month, 1);
      const startDay = firstDayOfMonth.getDay();
      const daysInMonth = new Date(year, month + 1, 0).getDate();
      const prevMonthDays = new Date(year, month, 0).getDate();

      const totalCells = startDay + daysInMonth;
      const rowsNeeded = Math.ceil(totalCells / 7);
      const cellsTotal = rowsNeeded * 7;

      const today = new Date();
      const todayStrVal = today.toISOString().slice(0, 10);

      for (let i = 0; i < cellsTotal; i++) {
        const cell = document.createElement("button");
        cell.type = "button";
        cell.className = "day-cell";

        let cellDate;
        if (i < startDay) {
          const dayNum = prevMonthDays - (startDay - 1 - i);
          cellDate = new Date(year, month - 1, dayNum);
          cell.classList.add("other-month");
        } else if (i >= startDay + daysInMonth) {
          const dayNum = i - (startDay + daysInMonth) + 1;
          cellDate = new Date(year, month + 1, dayNum);
          cell.classList.add("other-month");
        } else {
          const dayNum = i - startDay + 1;
          cellDate = new Date(year, month, dayNum);
        }

        const cellDateStr = cellDate.toISOString().slice(0, 10);
        cell.dataset.date = cellDateStr;

        const header = document.createElement("div");
        header.className = "day-header";

        const numEl = document.createElement("div");
        numEl.className = "day-number";
        numEl.textContent = cellDate.getDate();
        header.appendChild(numEl);

        const ownerBadge = document.createElement("div");
        ownerBadge.className = "owner-badge";
        header.appendChild(ownerBadge);

        cell.appendChild(header);

        const tasksForDay = tasks.filter((t) => occursOnDate(t, cellDate));

        if (tasksForDay.length > 0) {
          const ownersForDay = Array.from(
            new Set(
              tasksForDay.map((t) => getOwnerKey(t.owner))
            )
          );
          const mainOwner = tasksForDay[0].owner;
          ownerBadge.style.backgroundColor = getOwnerColor(mainOwner);
          cell.classList.add("has-task");

          const tasksInline = document.createElement("div");
          tasksInline.className = "day-tasks-inline";

          tasksForDay.slice(0, 3).forEach((task) => {
            const row = document.createElement("div");
            row.className = "day-task-inline";

            const dot = document.createElement("div");
            dot.className = "day-task-dot";
            dot.style.backgroundColor = getOwnerColor(task.owner);
            row.appendChild(dot);

            const text = document.createElement("span");
            text.className = "day-task-text";
            text.textContent = task.text || "(no description)";
            if (task.status === "Done") {
              text.classList.add("done");
            }
            row.appendChild(text);

            tasksInline.appendChild(row);
          });

          if (tasksForDay.length > 3) {
            const more = document.createElement("span");
            more.className = "day-task-text";
            more.textContent = `+${tasksForDay.length - 3} more`;
            tasksInline.appendChild(more);
          }

          cell.appendChild(tasksInline);
        } else {
          ownerBadge.style.backgroundColor = "transparent";
        }

        if (cellDateStr === todayStrVal) {
          cell.classList.add("today");
        }

        if (selectedDateStr && selectedDateStr === cellDateStr) {
          cell.classList.add("selected");
        }

        cell.addEventListener("click", () => {
          selectedDateStr = cellDateStr;
          calendarGrid
            .querySelectorAll(".day-cell.selected")
            .forEach((c) => c.classList.remove("selected"));
          cell.classList.add("selected");
        });

        calendarGrid.appendChild(cell);
      }
    }

    function handleAddTask() {
      const text = taskInput.value.trim();
      const owner = ownerInput.value.trim();
      const startDate = dateInput.value || todayStr();
      const frequency = freqSelect.value || "once";

      if (!text) {
        alert("Please type a task first.");
        return;
      }

      const newTask = {
        id: Date.now() + Math.random().toString(16).slice(2),
        text,
        owner: owner || "Family",
        startDate,
        frequency,
        status: "Not started",
      };

      tasks.push(newTask);
      saveTasks();
      renderTaskList();

      taskInput.value = "";
      ownerInput.value = "";
    }

    addButton.addEventListener("click", handleAddTask);

    prevMonthBtn.addEventListener("click", () => {
      currentMonth.setMonth(currentMonth.getMonth() - 1);
      renderCalendar();
    });

    nextMonthBtn.addEventListener("click", () => {
      currentMonth.setMonth(currentMonth.getMonth() + 1);
      renderCalendar();
    });

    loadTasks();
  </script>
</body>
</html>
